#### 一、状态可变性修饰符（State Mutability）

这类修饰符主要用于规定函数和区块链状态之间的交互方式。

- **view**

    - 功能：表明函数不会对状态进行修改，但可以读取状态变量。

    - 限制：在使用了`view`修饰符的函数内部，不可以出现以下操作：

        - 修改状态变量。

        - 生成事件。

        - 创建合约。

        - 使用`selfdestruct`或`suicide`。

        - 发送ETH。

        - 调用非`view`或者`pure`函数。

    - 注意​：链下调用时不消耗 Gas，但内部调用仍消耗。

    - 底层原理：EVM 调用 view 函数时，会对当前区块链状态（包括所有状态变量、账户余额等）创建临时快照，函数所有读取操作均基于此快照以确保数据一致性；若函数中出现修改状态的操作（如修改变量、发送 ETH 等），EVM 会直接阻止并回滚，保证区块链实际状态不被改变。这一机制既允许安全读取数据，又通过快照隔离和回滚严格限制修改权限，符合 view 函数 “只读不写” 的核心特性。

    - 最佳实践​：

        - 所有查询类函数均标记 `view`（如 `balanceOf()`）。

        - 避免调用非 `view`/`pure` 函数。

- **pure**

    - 功能：意味着函数既不会读取也不会修改状态变量。

    - 限制：在使用了`view`修饰符的函数内部，不可以出现以下操作：

        - **不能读取状态变量。**

        - 修改状态变量。

        - 生成事件。

        - 创建合约。

        - 使用`selfdestruct`或`suicide`。

        - 发送ETH。

        - 调用非`view`或者`pure`函数。

- **payable**

    - 功能：允许函数在被调用时接收 ETH，并且可以通过 `msg.value` 来获取转账金额。

    - 注意：必须配合`msg.value`使用，否则 ETH 会被锁定在合约中。

#### 二、访问权限修饰符（Visibility）

此类修饰符用于控制函数的访问范围。

- **public**

    - 合约内部可调用（如`this.publicFunc()`）。

    - 外部可通过 ABI 调用。

    - 自动生成 getter 函数（针对状态变量）。

    - **Gas 成本**：

        - 内部调用（通过`JUMP`指令）成本低

        - 外部调用需通过 ABI 编码 / 解码，成本较高

- **private**

    - 作用域

        - 仅在当前合约中可访问。

        - 同一文件中的不同合约（即使无继承关系）可访问。

        - 嵌套函数可访问。

        - **继承合约无法访问**。

- **internal**

    - 当前合约可以访问。

    - 可被继承合约访问，但不可被外部调用。

    - 适合定义基础逻辑（如 ERC20 的_transfer 函数）

- **external**

    - 仅支持外部调用（其他合约或用户）。

    - 参数存于 calldata（只读），比 `public` 节省 20-30% Gas（尤其大型数据）。

    - 内部调用需 `this.func()`，成本高且易引发重入风险。

    - 限制​：不可用于状态变量。

#### 三、继承相关修饰符（Inheritance）

这些修饰符用于处理函数在继承体系中的行为。

- **virtual**

    - 允许子合约重写父函数。

    - `private`函数不能标记为`virtual`。

    - 状态变量的 getter 函数默认是`virtual`。

- **override**

    - 必须与父函数签名完全一致（包括参数、返回值、可见性和状态可变性）。

    - 显式重写父合约的 `virtual` 函数。

    - 多重继承需指定父合约（如 `override(ParentA, ParentB)`）。

#### 四、总结

|​**场景**​|​**推荐修饰符组合**​|​**原因**​|
|-|-|-|
|外部交易入口|`external payable`|节省 Gas + 接收 ETH|
|内部工具函数|`private pure`|封装计算逻辑，无状态依赖|
|可继承共享逻辑|`internal virtual`|子类可扩展 + 避免外部暴露|
|状态查询接口|`public view`|内外可调用 + 零 Gas 成本（外部）|
|敏感操作（如提款）|`external onlyOwner`|省 Gas + 权限控制|

